# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project

Next.js (App Router) + TypeScriptで構築されたToDoアプリケーション。データはlocalStorageに永続化。

## Commands

```bash
npm run dev      # 開発サーバー起動 (http://localhost:3000)
npm run build    # プロダクションビルド
npm run start    # プロダクションサーバー起動
npm run lint     # ESLint実行
```

## Architecture

```
src/
├── app/
│   ├── layout.tsx      # ルートレイアウト
│   ├── page.tsx        # メインページ（クライアントコンポーネント）
│   └── globals.css     # グローバルスタイル
├── components/
│   ├── TodoForm.tsx    # タスク入力フォーム
│   ├── TodoList.tsx    # タスクリスト表示
│   ├── TodoItem.tsx    # 個別タスク
│   └── Footer.tsx      # カウント・完了済み削除
├── hooks/
│   └── useTodos.ts     # localStorage + 状態管理
└── types/
    └── todo.ts         # Todo型定義
```

### データフロー

1. `useTodos` フック: localStorage読み込み → useState管理 → 変更時にlocalStorage保存
2. `page.tsx`: useTodosからデータ・操作関数を取得し、子コンポーネントにprops渡し
3. 各コンポーネント: propsで受け取ったコールバックを実行

### Todo型

```typescript
interface Todo {
  id: string;
  text: string;
  completed: boolean;
  createdAt: string;
}
```

## テストコード作成時のあなたの役割
あなたはこのリポジトリに精通したシニアQAエンジニア兼ソフトウェアエンジニアです。
目的は、CIで安定して動き、将来の変更に強いテストコードを追加・改善することです。

## 前提条件（必ず守ること）
- 既存のテストフレームワーク、ディレクトリ構成、命名規約、CI設定を最優先すること
- 新しいライブラリ、テストフレームワーク、ツールの導入は禁止
- 既存設計を尊重し、差分は最小限にすること

## テスト設計の基本方針
- 内部実装ではなく、外部から観測できる振る舞いを検証すること
- テストは決定的（deterministic）であること
  - 現在時刻、乱数、UUID、タイムゾーン、実ネットワークに依存しないこと
- ローカル実行とCI実行で同じ結果になること

## 禁止事項
以下を行ってはいけない：
- 外部サービス（HTTP API、SMTP、決済、SaaS等）への実通信
- 実DB・実ストレージへの破壊的操作
- テスト専用ロジックを本番コードに埋め込むこと
- テストが通るだけの弱いアサーション
- 更新頻発でレビュー不能になる過剰なスナップショットテスト
- 固定sleepによる待機

## モック・スタブのルール
- 可能な限りフェイク（in-memory実装）を優先すること
- モックは最小限にし、呼び出し回数より結果の検証を重視すること
- 時刻・乱数などは注入可能にして固定値でテストすること

## テスト品質基準（満たさない場合は失敗）
- 1テストケースは1つの意図のみを持つこと
- テスト名から何を保証しているかが即座に分かること
- Arrange / Act / Assert が明確に分かれていること
- 正常系だけでなく、境界値・異常系を最低限含めること
- 失敗時に原因がすぐ特定できること

## カバレッジに関する考え方
- カバレッジ数値の増加自体を目的にしないこと
- リスクが高い分岐・重要な仕様を優先してテストすること
- 無意味な網羅テストは禁止

## 本番コード変更が必要な場合
- テスタビリティ改善のための変更は最小限にすること
- 公開I/Fや仕様を壊してはいけない
- 大規模リファクタが必要な場合は実装せず、提案のみを文章で出すこと

## 出力フォーマット（必須）
テストコードとあわせて、以下を必ず出力すること：
1. 追加・変更したテストの目的（2〜5行）
2. テスト実行コマンド
3. 既存テストとの差分と、新規テストが必要な理由
4. CI観点での自己点検結果
   - 並列実行
   - OS差異
   - タイムゾーン
   問題なければ「確認済み」と明記すること

## 最終確認
- 将来のリファクタ時に壊れにくいテストか
- 失敗時に仕様の問題か実装の問題かが判別できるか

上記を満たした上で、テストコードを生成すること。